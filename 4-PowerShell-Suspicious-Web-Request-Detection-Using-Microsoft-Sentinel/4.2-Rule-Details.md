# Rule Details

This section outlines the configuration and strategic intent behind the custom analytics rule designed to detect suspicious PowerShell behaviour using Microsoft Sentinel.

## Detection Rule Configuration

- **Rule Name:** Noble – Create Alert Rule (PowerShell Suspicious Web Request)
- **Severity Level:** Medium
- **Detection Method:** Scheduled Query Rule (KQL)
- **Frequency:** Every 4 hours
- **Target Host:** `noble-win10` (designated test endpoint)
- **Alert Grouping:** Enabled (grouped by `DeviceName`)
- **Enrichment Fields:** 
  - `Hostname`
  - `ProcessCommandLine`
  - `AccountName`
- **Alert Source Table:** `DeviceProcessEvents` (from Microsoft Defender for Endpoint)

## Purpose

This rule was developed to identify instances where PowerShell (`powershell.exe`) is used to run the `Invoke-WebRequest` command. This command is frequently leveraged by adversaries to fetch remote scripts or binaries—behaviours commonly associated with the initial stages of a cyberattack (e.g., malware delivery, staging, or command-and-control setup).

By monitoring this activity, organisations can be alerted to potentially harmful command executions before further compromise occurs.

## Why This Matters

- **High Signal, Low Noise:** The rule is highly specific, focusing only on PowerShell executions containing `Invoke-WebRequest`. This reduces false positives.
- **Context-Rich Alerts:** Enriched fields like `ProcessCommandLine` and `AccountName` allow SOC analysts to quickly determine the context of the execution and user attribution.
- **Device-Level Alert Grouping:** Grouping alerts by device helps reduce alert fatigue by consolidating related signals, making triage and investigation more efficient.

## Alignment with MITRE ATT&CK Techniques

| Technique ID | Name                          | Relevance                                  |
|--------------|-------------------------------|---------------------------------------------|
| T1059        | Command and Scripting Interpreter | PowerShell usage as execution medium       |
| T1204        | User Execution                | Potential user-triggered script downloads  |
| T1105        | Ingress Tool Transfer         | Downloading tools or payloads from the web |
| T1562        | Impair Defences               | Scripts may attempt to disable defences    |

This rule contributes to a defence-in-depth detection strategy that prioritises **early-stage attack behaviours**, increasing the chances of containing threats before full execution or lateral movement occurs.
